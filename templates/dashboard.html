<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-3">
    <h2>Benvenuto, {{ user.username }} ({{ user.role }})</h2>
    <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary mb-3">Logout</a>

    {% if user.role == 'user' %}
    <!-- Form richiesta nuova VM -->
    <div class="card mb-3">
        <div class="card-header">Richiedi nuova VM</div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('default.request_vm') }}">
                <div class="mb-3">
                    <label for="vm_type" class="form-label">Tipo VM</label>
                    <select name="vm_type" class="form-select">
                        <option value="bronze">Bronze - 1 core - 2048MB RAM - 10GB Disk</option>
                        <option value="silver">Silver - 2 core - 4096MB RAM - 20GB Disk</option>
                        <option value="gold">Gold - 4 core - 8192MB RAM - 40GB Disk</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Invia richiesta</button>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- Tabella richieste -->
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Tipo VM</th>
                <th>Stato</th>
                <th>Hostname</th>
                <th>IP</th>
		<th>User</th>
                <th>Password</th>
                {% if user.role == 'admin' %}
                <th>Azioni</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for r in requests %}
            <tr>
                <td>{{ r.id }}</td>
                <td>{{ r.vm_type }}</td>
                <td>{{ r.status }}</td>
                <td>{% if r.vm_instance %}{{ r.vm_instance.hostname }}{% else %}-{% endif %}</td>
                <td>{% if r.vm_instance %}{{ r.vm_instance.ip_address }}{% else %}-{% endif %}</td>
                <td>{% if r.vm_instance %}{{ r.vm_instance.vm_user }}{% else %}-{% endif %}</td>
                <td>{% if r.vm_instance %}{{ r.vm_instance.vm_password }}{% else %}-{% endif %}</td>
		{% if user.role == 'admin' %}
                <td>
                    {% if r.status == 'pending' %}
                        <a href="{{ url_for('vmReq.approve', req_id=r.id) }}" class="btn btn-success btn-sm">Approva</a>
                        <a href="{{ url_for('vmReq.reject', req_id=r.id) }}" class="btn btn-danger btn-sm">Rifiuta</a>
                    {% else %}
                        -
                    {% endif %}
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
